<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>PDF阅读器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.17.112/pdf.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2a3747;
            --secondary-color: #0066cc;
            --bg-color: #f5f5f5;
            --text-color: #333;
            --control-bg: rgba(255, 255, 255, 0.9);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .pdf-viewer {
            position: relative;
            min-height: 90vh;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .pdf-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .pdf-page {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
            border-radius: 4px;
        }
        
        .controls {
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--control-bg);
            border-top: 1px solid #e0e0e0;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        
        .controls.hidden {
            transform: translateY(100%);
        }
        
        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }
        
        .btn:hover {
            background-color: #0052a3;
            transform: scale(1.05);
        }
        
        .btn:disabled {
            background-color: #a0c4ff;
            cursor: not-allowed;
            transform: none;
        }
        
        .page-info {
            font-size: 14px;
            color: #666;
            padding: 0 15px;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }
        
        .spinner {
            border: 4px solid rgba(0, 102, 204, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--secondary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 移动设备优化 */
        @media (max-width: 600px) {
            .controls {
                padding: 8px 12px;
            }
            
            .btn {
                width: 36px;
                height: 36px;
            }
            
            .page-info {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pdf-viewer">
            <div class="loading">
                <div class="spinner"></div>
                <p>正在加载PDF...</p>
            </div>
            
            <div class="pdf-container" id="pdf-container"></div>
            
            <div class="controls" id="controls">
                <button class="btn" id="prev-page" disabled>
                    <i class="fa fa-chevron-left"></i>
                </button>
                <div class="page-info" id="page-info">加载中...</div>
                <button class="btn" id="next-page">
                    <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // 配置PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.17.112/pdf.worker.min.js';
        
        // PDF文件路径
        const pdfPath = 'DataSparkle2025Africa.pdf';
        
        // DOM元素
        const pdfContainer = document.getElementById('pdf-container');
        const loadingIndicator = document.querySelector('.loading');
        const controls = document.getElementById('controls');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        
        // 全局变量
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 0;
        
        // 计算适合当前设备的缩放比例
        function getScale() {
            const isMobile = window.innerWidth < 600;
            // 移动端使用较小的缩放比例，桌面端使用较大的比例
            return isMobile ? 0.8 : 1.2;
        }
        
        // 加载PDF
        async function loadPDF() {
            try {
                pdfDoc = await pdfjsLib.getDocument(pdfPath).promise;
                totalPages = pdfDoc.numPages;
                updatePageInfo();
                await renderPage(currentPage);
                loadingIndicator.style.display = 'none';
                updateButtonStates();
            } catch (error) {
                console.error('加载PDF失败:', error);
                loadingIndicator.innerHTML = `<p>加载失败: ${error.message}</p>`;
            }
        }
        
        // 渲染指定页面
        async function renderPage(pageNum) {
            const page = await pdfDoc.getPage(pageNum);
            const scale = getScale();
            const viewport = page.getViewport({ scale });
            
            // 创建canvas元素
            const canvas = document.createElement('canvas');
            canvas.className = 'pdf-page';
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            
            // 清空容器并添加新页面
            pdfContainer.innerHTML = '';
            pdfContainer.appendChild(canvas);
            
            // 渲染页面
            const renderContext = {
                canvasContext: canvas.getContext('2d'),
                viewport: viewport
            };
            
            await page.render(renderContext).promise;
        }
        
        // 更新页码信息
        function updatePageInfo() {
            pageInfo.textContent = `第 ${currentPage} 页 / 共 ${totalPages} 页`;
        }
        
        // 更新按钮状态
        function updateButtonStates() {
            prevPageBtn.disabled = currentPage <= 1;
            nextPageBtn.disabled = currentPage >= totalPages;
        }
        
        // 上一页
        async function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                await renderPage(currentPage);
                updatePageInfo();
                updateButtonStates();
            }
        }
        
        // 下一页
        async function goToNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                await renderPage(currentPage);
                updatePageInfo();
                updateButtonStates();
            }
        }
        
        // 窗口大小变化时重新渲染
        window.addEventListener('resize', async () => {
            if (pdfDoc) {
                await renderPage(currentPage);
            }
        });
        
        // 绑定事件
        prevPageBtn.addEventListener('click', goToPrevPage);
        nextPageBtn.addEventListener('click', goToNextPage);
        
        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') goToPrevPage();
            if (e.key === 'ArrowRight') goToNextPage();
        });
        
        // 滚动时自动隐藏/显示控制栏
        let lastScrollTop = 0;
        pdfContainer.addEventListener('scroll', () => {
            const scrollTop = pdfContainer.scrollTop;
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                controls.classList.add('hidden');
            } else {
                controls.classList.remove('hidden');
            }
            lastScrollTop = scrollTop;
        });
        
        // 初始化
        loadPDF();
    </script>
</body>
</html>
